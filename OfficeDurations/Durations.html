<!DOCTYPE html>
<html lang="tr-TR"><!-- ?? tr-TR ?? -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date sorting</title>
    <link rel="stylesheet" href="css/style.css">
    
<!--
Türkiye Cumhuriyeti kurulmasından itibaren, devlet yönetiminde olan kişilerin, görevleri ve görevde bulundukları sürelerin zamana çizelgesinde gösterilmesi. 
    - Görev filtresi.
    - Sıralama seçenekleri. Alfabetik, yıla göre
    - Gösterim detay filtresi.
    - Kişi adı arama. Yazdıkça alternatiflerin gelmesi...(opsiyonel.)
Görsel Özellikler
    - üst tarafta sabit menü üzerinde filtre ve sıralama seçenekleri
    - üst tarafta sabit menünün hemen altında yine sabit olacak şekilde yıl kılavuzları. 10 yıllık aralıklar ile
    - her bir kişinin yanında toplam görev süresini gösteren zaman çizelgesi ve toplam gün sayısı
    - her bir kişinin altında yıllara göre görevleri ve zaman çizelgesi gösterimi
-->
</head>
<body>
<div class="container">
    <div id="header">
        <form id="preferences" name="preferences">
        <span>
            <fieldset>
                <legend>Gruplama</legend>
                <input name="group" type="radio" onclick="reload()" value ="k" Checked> Kişi
                <input name="group" type="radio" onclick="reload()" value ="g"> Görev
            </fieldset>
        </span>
        
        <span>
            <fieldset >
                <legend>Filtre</legend>
                <input name="filtre" value="c" id="c" type="checkbox" onclick="reload()" checked>Cumhurbaşkanı
                <input name="filtre" value="b" id="b" type="checkbox" onclick="reload()" checked>Başbakan
                <input name="filtre" value="d" id="d" type="checkbox" onclick="reload()" checked>Bakanlar
            </fieldset>
           
        </span>
        
        <span >
            <fieldset>
               <legend>Sıralama</legend>
                <input name="sira" type="radio" onclick="reload()" value="t" checked>Tarihe Göre
                <input name="sira" type="radio" onclick="reload()" value="a" >Alfabetik
                <input name="sira" type="radio" onclick="reload()" value="g" >Görev Süresi
            </fieldset>
        </span>
        
       
        <span >
            <fieldset>
                <legend>Gösterim</legend>
                <input name="detay" type="radio" onclick="reload()" value="a" id="a">Sadece Başlık
                <input name="detay" type="radio" onclick="reload()" checked>Hepsini Göster
            </fieldset>
        </span>
        </form>
        
      <span style="width: 1300px;height:100%">
                <span class="gorevline hyear" style="left: 290px; width: 1px;">1920</span>
                <span class="gorevline hyear" style="left: 390px; width: 1px;">1930</span>
                <span class="gorevline hyear" style="left: 490px; width: 1px;">1940</span>
                <span class="gorevline hyear" style="left: 590px; width: 1px;">1950</span>
                <span class="gorevline hyear" style="left: 690px; width: 1px;">1960</span>
                <span class="gorevline hyear" style="left: 790px; width: 1px;">1970</span>
                <span class="gorevline hyear" style="left: 890px; width: 1px;">1980</span>
                <span class="gorevline hyear" style="left: 990px; width: 1px;">1990</span>
                <span class="gorevline hyear" style="left: 1090px; width: 1px;">2000</span>
                <span class="gorevline hyear" style="left: 1190px; width: 1px;">2010</span>
                <span class="gorevline hyear" style="left: 1290px; width: 1px;">2020</span>
                
            </span>
    
   </div>

    
  
</div>

<div id="demo"></div>
<hr id="mybar">
<div id="notes">
    <strong>Notlar:</strong>
    <ul >
        <li>Cumhurbaşkanı listesini Cumhurbaşkanlığı websitesindeki bu <a href="https://www.tccb.gov.tr/cumhurbaskanlarimiz/">sayfadan</a>,
        Başbakan ve Bakanlık bilgilerinin çoğunu TBMM'nin websitesindeki bu <a href="https://www.tbmm.gov.tr/kutuphane/e_kaynaklar_kutuphane_hukumetler.html">sayfadan</a> ,
        Eksik kalan Başbakan ve Bakanlık bilgilerini Başbakanlık websitesindeki bu <a href="https://www.basbakanlik.gov.tr/Forms/_Global/_Government/pg_CabinetHistory.aspx">sayfadan</a> tamamladık.</li>
        <li>Cumhuriyet tarihi boyunca hükümet yapısı, bakanlık yapısı ve görevleri değişiklikler göstermektedir. Biz de elimizdeki listeyi mevcut hükümetteki bakanlıklar ile eşleştirmeye çalıştık.
        Bu çalışmayı yaparken ilgili bakanlığın web sitesinde verilen bilgileri temel aldık. Ancak her bakanlığın web sitesi bakanlık tarihçesi ya da eski bakan listesi içermediğinden
        bazı tahminlerde bulunduk.</li>
        <li>"Devlet Bakanı" ve "Başbakan Yardımcısı" görevlerinin detayları bu sitenin amacı açısından bir önem oluşturmadığından hepsi "Devlet Bakanı" olarak sınıflandırıldı.</li>
        <li>Bir dönemde aynı pozisyonda iki bakan gözüküyor olabilir. Muhtemelen kabine değişikliği yapıldı ancak detay olmadığından hükümet tarihleri temel alındı. Bazı durumlarda bakanlıklar birleştirilip
        yeni bakanlıklar kurulmuş olabilir. </li>
        
      <li> Bakanlık Eşleştirme Listesi
          <table>
            <tr><th> Yeni Bakanlık</th><th>Eski Bakanlık</th><th>Linkler</th></tr>
            <tr><td>Başbakan</td><td>Başvekil</td><td>-</td></tr>
            <tr><td>Başbakan Yardımcısı</td><td>Başvekil Yardımcısı</td><td>-</td></tr>
            <tr><td>Adalet Bakanı</td><td>Adliye Bakanı<br>Adliye Vekili</td><td></td></tr>
            <tr><td>Aile ve Sosyal Politikalar Bakanı</td><td>-</td><td>-</td></tr>
            <tr><td>Avrupa Birliği Bakanı</td><td>-</td><td>-</td></tr>
            <tr>
                <td>Bilim Sanayi ve Teknoloji Bakanı </td>
                <td>Sanayi ve Ticaret Bakanı<br>
                Sanayi Bakanı<br>
                Sanayi Vekili<br>
                Sanayi ve Teknoloji Bakanı</td>
                <td>
                    <a href="https://www.sanayi.gov.tr/history.html?lang=tr">Tarihçe</a><br>
                    <a href="https://www.sanayi.gov.tr/ministers.html?lang=tr">Eski Bakanlar</a><br>
                    <a href="https://web.archive.org/web/20170106122207/http://www.sanayi.gov.tr:80/bakanlar.html">Eski Eski Bakanlar</a></td>
              </tr>
            <tr>
                <td>Çalışma ve Sosyal Güvenlik Bakanı</td>
                <td>
                    Çalışma Bakanı<br>
                    Çalışma Vekili<br>
                    Sosyal Güvenlik Bakanı<br>
                </td>
                <td>
                    <a href="https://www.csgb.gov.tr/home/Contents/Bakanlik/Tarihce">Tarihçe</a><br>
                    <a href="https://www.csgb.gov.tr/home/Contents/Eski/Bakanlar"> Eski Bakanlar</a>
                </td>
              </tr>
            <tr>
                <td>Çevre ve Şehircilik Bakanı</td>
                <td>
                    Mübadele,İmar ve İskan Vekili<br>
                    Nafıa Bakanı<br>
                    Nafıa Vekili<br>
                    Bayındırlık Bakanı<br>
                    İmar ve İskan Bakanı<br>
                    İmar ve İskan Vekaleti Vekili<br>
                    İmar ve İskan Vekili<br>
                    Bayındırlık ve İskan Bakanı<br>
                    Bayındırlık ve İskân Bakanı</td>
              <td> <a href="http://www.csb.gov.tr/tarihcemiz-i-7012">Tarihçe</a></td></tr>
            <tr>
                <td>Dışişleri Bakanı</td>
                <td>Hariciye Bakanı<br>
                    Hariciye Vekili<br>
                Dış Ekonomik İlişkilerBakanı</td>
                <td>
                    <a href="http://www.mfa.gov.tr/turkiye-cumhuriyeti-disisleri-bakanligi-tarihcesi.tr.mfa">Tarihçe</a><br>
                    <a href="http://www.mfa.gov.tr/_disisleri-bakanlari-listesi.tr.mfa">Eski Bakanlar</a></td>
            </tr>
            <tr><td>Ekonomi Bakanı</td>
                <td>İktisat Bakanı<br>
                    İktisat Vekili<br>
                    İktisat ve Ticaret Vekili<br>
                    İktisat Vekili ve Ziraat Vekaleti Vekilliği<br>
                    Ticaret Bakanı<br>
                    Ticaret Vekili<br>
                    Ekonomi ve Ticaret Bakanı<br>
                    İşletmeler Bakanı<br>
                    İşletmeler Vekili<br>
                    
                </td>
              <td>
                <a href="https://www.ekonomi.gov.tr/portal/faces/home/kurumsal">Tarihçe</a></td></tr>
            <tr><td>Enerji ve Tabii Kaynaklar Bakanı</td>
                <td>-</td>
              <td>
                  <a href="http://www.enerji.gov.tr/tr-TR/Sayfalar/Tarihce">Tarihçe</a><br>
                  <a href="http://www.enerji.gov.tr/tr-TR/EskiBakanlarimiz">Eski Bakanlar</a></td></tr>
            <tr><td>Gençlik ve Spor Bakanı</td><td>-</td><td>-</td></tr>
            <tr><td>Gıda Tarım ve Hayvancılık Bakanı</td>
                <td>
                    Köyişleri Bakanı <br>
                    Köyişleri ve Kooperatifler Bakanı<br>
                    Ziraat Bakanı<br>
                    Ziraat Vekili<br>
                    Ziraat Vekili ve Ticaret Vekaleti Vekili<br>
                    Tarım Bakanı<br>
                    Tarım Orman ve Köyişleri Bakanı<br>
                    Tarım ve Köyişleri Bakanı<br>
                    Tarım ve Orman Bakanı
                </td>
              <td>
                <a href="https://www.tarim.gov.tr/Sayfalar/Bakanlik.aspx?OgeId=4&Liste=Bakanlik">Eski Bakanlar</a></td></tr>
            <tr><td>Gümrük ve Ticaret Bakanı</td>
                <td>
                    Tekel Bakanı<br>
                    Gümrük ve Tekel Bakanı<br>
                    Gümrük ve Ticaret Bakanı<br>
                    Gümrük ve İnhisarlar Bakanı<br>
                    Gümrük ve İnhisarlar Vekili<br>
                Maliye ve Gümrük Bakanı
                </td>
              <td>
                  <a href="https://www.gtb.gov.tr/kurumsal/hakkimizda/tarihce">Tarihçe</a><br>
                <a href="https://www.gtb.gov.tr/kurumsal/arsiv/eski-bakanlar">Eski Bakanlar</a></td></tr>
            <tr><td>İçişleri Bakanı</td>
                <td>Dahiliye Bakanı<br>Dahiliye Vekili<br>
                Dahiliye Vekili ve Mübadele,İmar ve İskan Vekaleti Vekili</td>
              <td>
                  <a href="https://www.icisleri.gov.tr/bakanligimizin-tarihcesi">Tarihçe</a><br>
                <a href="https://www.icisleri.gov.tr/gorev-yapmis-bakanlarimiz1">Eski Bakanlar</a></td></tr>
            <tr><td>Kalkınma Bakanı</td><td>-</td><td>-</td></tr>
            <tr><td>Kültür ve Turizm Bakanı</td>
                <td>Kültür Bakanı<br>
                Turizm Bakanı<br>
                    Turizm ve Tanıtma Bakanı<br>
                    Basın Yayın ve Turizm Bakanı<br>
                    Basın Yayın ve Turizm Vekili
                </td>
              <td>
                <a href="http://www.kultur.gov.tr/TR,96137/bakanligimizda-bakan-olarak-gorev-yapanlara-ait-isim-li-.html">Eski Bakanlar 1</a><br>
                <a href="http://www.kultur.gov.tr/TR,96138/teskilat-kanunundan-sonra-atanan-bakanlar-1963---1981-a-.html">Eski Bakanlar 2</a><br>
                <a href="http://www.kultur.gov.tr/TR,96140/kultur-bakanligina-atanan-bakanlar-1971---2003-arasi.html">Eski Bakanlar 3</a><br>
                <a href="http://www.kultur.gov.tr/TR,96141/turizm-bakanligina-atanan-bakanlar-1989---1999-arasi.html">Eski Bakanlar 4</a><br>
                <a href="http://www.kultur.gov.tr/TR,96142/turizm-bakanligina-atanan-bakanlar-1999---2003-arasi.html">Eski Bakanlar 5</a><br>
                  <a href="http://www.kultur.gov.tr/TR,96143/kultur-ve-turizm-bakanligina-atanan-bakanlar-2003-sonra-.html">Eski Bakanlar 6</a></td></tr>
            <tr><td>Maliye Bakanı</td>
                <td>Maliye Vekili<br>
                Maliye ve Gümrük Bakanı**</td>
              <td>
                  <a href="http://www.maliye.gov.tr/tarihce">Tarihçe</a><br>
                <a href="http://www.maliye.gov.tr/maliye-bakanlari">Eski Bakanlar</a></td></tr>
            <tr><td>Milli Eğitim Bakanı</td>
                <td>Maarif Bakanı<br>
                    Maarif Vekili<br>
                Milli Eğitim Gençlik ve Spor Bakanı<br>
                    Millî Eğitim Bakanı<br>
                    Milli Eğitim ve Kültür Bakanı
                </td>
              <td>
                  <a href="http://www.meb.gov.tr/milli-egitim-bakanliginin-kisa-tarihcesi/duyuru/8852">Tarihçe</a><br>
                  <a href="http://www.meb.gov.tr/meb/">Eski Bakanlar</a>
                </td></tr>
            <tr><td>Milli Savunma Bakanı</td>
                <td>Milli Müdafaa Bakanı<br>
                    Milli Müdafaa Vekili<br>
                Müdafaai Milliye Vekili<br>
                Millî Savunma Bakanı<br>
                Erkanı Harbiyei Umumiye Vekili</td>
              <td>
                  <a href="http://www.msb.gov.tr/Bakanlar">Eski Bakanlar</a></td></tr>
            <tr><td>Orman ve Su İşleri Bakanı</td><td>Orman Bakanı<br>Çevre ve Orman Bakanı</td><td>-</td></tr>
            <tr><td>Sağlık Bakanı</td>
                <td>Sıhhat ve İçtimai Muavenet Bakanı<br>
                    Sıhhat ve İçtimai Muavenet Vekili<br>
                    Sıhhiye Vekili<br>
                    Sıhhiye ve Muavenet, İçtimaiye Vekili<br>
                    Sıhhiye ve İçtimai Muavenet Vekili<br>
                    Sağlık ve Sosyal Yardım Bakanı<br>
                Sıhhiyeve Muaveneti İçtimaiye Vekili</td>
              <td>
                  <a href="https://www.saglik.gov.tr/TR,11492/tarihce.html">Tarihçe</a><br>
                <a href="https://www.saglik.gov.tr/TR,11490/bakanlarimiz.html">Eski Bakanlar</a></td></tr>
            <tr><td>Ulaştırma, Denizcilik ve Haberleşme Bakanı</td>
                <td>Bahriye Vekili<br>
                Ulaştırma Bakanı<br>
                Münakalat Bakanı<br>
            Münakalat Vekili<br>
                Muhabere ve Münakale Vekili</td>
              <td><a href="http://www.ubak.gov.tr/">Tarihçe</a></td></tr>
          </table>
        </li>
        <li>
            Şu üç bakanlığı kendi haline bıraktık: 
            Koordinasyon Vekili ,            Şer’iye Vekili (Din İşleri Bakanı),            Yerel Yönetim Bakanı    
            
      </li>
        
        
    </ul>
    </div>

</body>
 

<script>
 
    /*
    
    TODO Notes:
    ----
    - format header nicely
    - sticky header and year guides
    - kisi collapse triangle (+/-)  and cursor
    - viewport sizable timeline
    - format nicely
    - year guides, timelines etc consistency. please not just put there
    - add - milletvekilleri, bakanlar,belediye başkanları
    - alfabetik sıralamada türkçe karakter sıkıntısı
    
    ++++
    + gorev dates in a more readable form
    + kisi collapsable. 
    + kisi (one timeline to show next to it would be blast)
    + timeline next to gorev definition
    + better calculation for timeline width 
    + number of days on the office to the right side of the kisi. 
    + filter for different gorevs
    + collapse all
    + right calculation for the repeated days. !!
    + fill out all kisiler...
    
    */
var veri=[];
var kisi_list = [];
var gorev_list = [];

    // const to for filters
const CUMHURBAŞKANI = "Cumhurbaşkanı";
const BASBAKAN = "Başbakan";
    
    // vertical guideline related items
var windowsize = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
var refelement = document.getElementById("mybar");
var topPos = refelement.getBoundingClientRect().top ;

     /**********************************/

function calculateTotalDays(days){
    // Gorev : ({"Ad": kisi.Ad,"BaslangicTarihi":new Date(gorev.Baslangic),"BitisTarihi":new Date(gorev.Bitis)});
    // Kisi  : ({"Ad": gorev.Tanimi,"BaslangicTarihi":gorev.BaslangicTarihi,"BitisTarihi":gorev.BitisTarihi,"Kodu": gorev.Kodu, "Visible":true});
    var td = 0;
    var newdays =[];
    days.sort(function(a,b){return a.BaslangicTarihi-b.BaslangicTarihi;});
    newdays = days.reduce(function(nd,item){
        if(nd[nd.length-1].ed> item.BitisTarihi){
            return nd;
        }
        if(nd[nd.length-1].ed.getTime()== item.BaslangicTarihi.getTime()  || 
          item.BaslangicTarihi <nd[nd.length-1].ed   &&  nd[nd.length-1].ed < item.BitisTarihi){
             nd[nd.length-1].ed=item.BitisTarihi;
             return nd;
        }
        if(nd[nd.length-1].ed< item.BaslangicTarihi){
            nd.push({"st":item.BaslangicTarihi,"ed":item.BitisTarihi});
            return nd;
        }
                
        return nd;
                
     },[{"st":days[0].BaslangicTarihi,"ed":days[0].BitisTarihi}]);
    
    td = newdays.reduce(function(td,i){
        td +=  Math.round((i.ed-i.st)/86400000 );
        return td;
    },0);
    return td;
         
/*
         function sortit(src){
       //document.getElementById("demo").innerHTML =
        var res=[];
        if(Array.isArray(src)){
            res.push(src[0]);
            for (i = 1; i < src.length; i++) {
                dt1 = res[res.length-1];
                dt2 = src[i];
                if(dt1.d2<dt2.d1){
                    res.push(src[i]);
                }
                else{
                    if(dt1.d2<dt2.d2){
                        res.pop(); res.push({d1:dt1.d1,d2:dt2.d2});
                    }
                }
            }
        }
        console.log(res);
        return res;
    }
*/
}
    
function updateHeight(){
    //console.log("start update height");
    topPos = refelement.getBoundingClientRect().top ;
    windowsize = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    var nh = ((topPos<=0) ? 0 : Math.min(windowsize,topPos)-50)
    //console.log("updating height => toppos " + topPos + "  windowsize : "+ windowsize + " => new height : " + nh);
    var bars = document.getElementsByClassName("hyear");   
    for (i=0;i<bars.length;i++)
        bars[i].style.height =(nh)+"px";
    
    //console.log("updated height");
}
window.addEventListener("resize", function(event) {
    //windowsize = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    updateHeight();
    //console.log("windowsize =>"+ windowsize);
});
window.addEventListener("scroll", function(e) {
    //topPos = refelement.getBoundingClientRect().top ;
    //console.log("scrolling =>"+ topPos + " windowsize => " + windowsize);
    updateHeight();

});
function transformToGorev(){
     gorev_list = veri.reduce(function(groups,kisi){
        for (var gorev of kisi.Gorevler){
            var mygroup = groups.find(function(elm){return elm["SubHeaderText"] == gorev.Kodu})
            if(!mygroup){
                groups.push({"SubHeaderText":gorev.Kodu,"Visible":true,"ToplamGun":0, "Items":[]})
                mygroup = groups[groups.length-1];
            }
            gorev.BaslangicTarihi = new Date(gorev.Baslangic);
            gorev.BitisTarihi = new Date(gorev.Bitis);
            //mygroup.ToplamGun+= Math.round((gorev.BitisTarihi-gorev.BaslangicTarihi)/86400000 );
           
            mygroup["Items"].push({"Ad": kisi.Ad,"BaslangicTarihi":new Date(gorev.Baslangic),"BitisTarihi":new Date(gorev.Bitis)});
        }
        return groups;
        
    },[{"SubHeaderText":veri[0].Gorevler[0].Tanimi,"Visible":true,"ToplamGun":0,"Items":[]}]);
       //var fark = 0;
    
    for(i=0;i< gorev_list.length;i++){
        gorev_list[i].ToplamGun = calculateTotalDays(gorev_list[i].Items);
        /*
        if(gorev_list[i].SubHeaderText.startsWith("Aile ve Sosyal"))
            debugger;
        var td = calculateTotalDays(gorev_list[i].Items)
        if (Math.abs( td - gorev_list[i].ToplamGun)>5)
            fark ++;
        gorev_list[i].ToplamGun = td;
        */
        
    }
        //alert(fark);
}
function transformToKisi(){
    if (veri=="") return;
    kisi_list = veri.map(function(kisi){
     
        var newobj = {"SubHeaderText": kisi.Ad + "("+kisi.Dogum + "-" + 
                      (kisi.Olum!=""?(new Date(kisi.Olum)).getFullYear():"") + ") ","ToplamGun":0,"Items":[] };

        for (var gorev of kisi.Gorevler){
            gorev.BaslangicTarihi = new Date(gorev.Baslangic);
            gorev.BitisTarihi = new Date(gorev.Bitis);
           // newobj.ToplamGun+= Math.round((gorev.BitisTarihi-gorev.BaslangicTarihi)/86400000 );
            newobj.Items.push({"Ad": gorev.Tanimi,"BaslangicTarihi":gorev.BaslangicTarihi,"BitisTarihi":gorev.BitisTarihi,"Kodu": gorev.Kodu, "Visible":true});
        }
        //kisi.Gorevler.sort(sortGorevler);
        //kisi.ilktarih=kisi.Gorevler[0].BaslangicTarihi;
        newobj.Items.sort(function(a,b){return a.BaslangicTarihi-b.BaslangicTarihi;});
        
        return newobj;
    });
//    var fark = 0;
    for(i=0;i< kisi_list.length;i++){
        kisi_list[i].ToplamGun =calculateTotalDays(kisi_list[i].Items);
        /*
        if(kisi_list[i].SubHeaderText.startsWith("Recep Tayyip"))
            debugger;
        var td = calculateTotalDays(kisi_list[i].Items)
        if (Math.abs( td - kisi_list[i].ToplamGun)>5)
            fark ++;
        kisi_list[i].ToplamGun = td;
        */
        
    }

        
}
function paintTimeline(elem,bas,bit,txt){
    var beginning = new Date("1920-01-01");
    var eGorevLine =document.createElement("span");
    eGorevLine.classList.add("gorevline");
   
    eGorevLine.style.left=(dateDiffToWidth(beginning,bas) + 300).toString() + "px";
    eGorevLine.style.width=dateDiffToWidth(bas,bit).toString() + "px";
    eGorevLine.textContent=txt;

    elem.appendChild( eGorevLine);
}
function dateDiffToWidth(bas,bit){
    var px =(((bit.getFullYear()-bas.getFullYear()) * 12) - bas.getMonth()+ bit.getMonth()) ;
    return  px/1.2 ;
}
function myclick(e){ // kisi başlığına tıklama için
    //TODO: more elegant way !!
    this.children[1].hidden= !(this.children[1].hidden);
    this.children[3].hidden= !(this.children[3].hidden);
    //this.lastElementChild.hidden=!(this.lastElementChild.hidden);
}
function sortGorevler(a,b){
        return a.BaslangicTarihi - b.BaslangicTarihi;
}
function loadData() { // Verileri yüklemek için AJAX request
   // console.log("loading data");
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    initData(this);
    }
  };
  xhttp.open("GET", "data/data.json", true);
  xhttp.send();
    // console.log("loaded data");
}
function initData(xml) { // Verilerin düştüğü yer
   // console.log("initializing data");
    veri =JSON.parse( xml.responseText);
    reload();
   // console.log("initialized data");
    updateHeight();
}
function reload(){
    // console.log("reloading data");
    if(veri=="")return;
    
    var cont = document.getElementById("demo").textContent;
    var group = document.preferences.group.value;
    var sortOrder = document.preferences.sira.value;

    var detay = document.preferences.detay.value;

    
    if(group == "k"){ //kişi bazlı gruplama
        if (kisi_list=="")
            transformToKisi(); // kişi listesini hazırla
        switch(sortOrder){
            case ("t"):
                // kişi listesi ilk göreve gelme zamanına göre sıralanır
                kisi_list.sort(function(a,b){return a.Items[0].BaslangicTarihi - b.Items[0].BaslangicTarihi;});
                break;
            case ("a"):
                // kişi listesi alfabetik sıralanır
                kisi_list.sort(function(a,b){return a.SubHeaderText.localeCompare(b.SubHeaderText); });
                break;
            case("g"):
                kisi_list.sort(function(a,b){return b.ToplamGun-a.ToplamGun; });  
                break;
            
        }
        applyFilter(kisi_list);
        loadList(kisi_list,detay);
    }
    if(group=="g"){ // gorev bazlı gruplama
        if (gorev_list =="") 
            transformToGorev();// görev listesini hazırla
        switch (sortOrder){
            case "t":
                // gorev grubu altındaki kişilerin başlangıç tarihi
                for(items of gorev_list)
                    items.Items.sort(function(a,b){return a.BaslangicTarihi-b.BaslangicTarihi;});
                gorev_list.sort(function(a,b){
                    //TODO: aynı tarihse alfabetik ?
                    a.Items[0].BaslangicTarihi-b.Items[0].BaslangicTarihi;
                    });
                break;
            case "a":
                // gorev grubu altındakilerin isimlerinin alfabetik sıralaması
                for(items of gorev_list)
                    items.Items.sort(function(a,b){
                        var x = a.Ad.toLocaleLowerCase();
                        var y = b.Ad.toLocaleLowerCase();
                        if (x<y){return -1;}
                        if (x>y){return 1;}
                        return 0;
                    });
                
                gorev_list.sort(function(a,b){
                        var x = a.SubHeaderText.toLocaleLowerCase();
                        var y = b.SubHeaderText.toLocaleLowerCase();
                        if (x<y){return -1;}
                        if (x>y){return 1;}
                        return 0;
                    });
                break;
            case ("g"):
                gorev_list.sort(function(a,b){return b.ToplamGun-a.ToplamGun; });  
                break;
        }
        applyFilter(gorev_list);
    loadList(gorev_list,detay);
    }
  updateHeight();        
    // console.log("reloaded data");
    

} 
function checkFilter(v){
    var c = document.getElementById("c").checked; // cumhurbaşkanı
    var b = document.getElementById("b").checked; // başbakan
    var d = document.getElementById("d").checked; // diğer bakanlıklar
    
    if ((v == CUMHURBAŞKANI && !c) || (v == BASBAKAN && !b) || (v != CUMHURBAŞKANI && v !=BASBAKAN && !d ) )
        return false;
    return true;
}
function applyFilter(list){
    for (i=0;i< list.length;i++){
        var baslik = list[i];
        
        if (!(baslik.Visible===undefined)){
            baslik.Visible = checkFilter(baslik.SubHeaderText)
            if (!baslik.Visible) continue;
        }
        for(var k = 0; k<baslik.Items.length;k++){
          var item = baslik.Items[k];
            if(!(item.Visible===undefined)){
                item.Visible = checkFilter(item.Kodu);
            }
        }
        
    }
}
function loadList(list,detay){
 if (list =="") return; 
   
            
 
 
  var eSubHeaderList = document.createElement("ul"); 
   
  for (i=0;i< list.length;i++){
      var subHeader =list[i];
      
     
      if (!(subHeader.Visible===undefined) && !subHeader.Visible) continue;
      //var kisiArticle = document.createElement("ul");
      var eSubHeader = document.createElement("li");
      eSubHeader.classList.add("subHeader");
      eSubHeader.addEventListener("click",myclick);
      
      var eSubHeaderText = document.createElement("span");
      //"&#x25BC;"  aşağı üçgen  //&#x25B6; sağa bakan  //&#x25C0; sola bakan
      eSubHeaderText.textContent=  subHeader.SubHeaderText; 
      eSubHeaderText.classList.add("kisiadi");
      eSubHeader.appendChild(eSubHeaderText);
      
      var eSubHeaderTimeLine = document.createElement("span");
      eSubHeaderTimeLine.hidden=true;
      
      var eItemList = document.createElement("ul");
      eItemList.className="itemlist";
      
      var toplamGun = 0;

      for(var k = 0; k<subHeader.Items.length;k++){
          var item = subHeader.Items[k];
          if ((!(item.Visible===undefined)) && !item.Visible) continue;
           
              var eItem=document.createElement("li");
              var eItemSpan = document.createElement("span");
              eItemSpan.classList.add("item");

              //toplamGun+= Math.round((item.BitisTarihi-item.BaslangicTarihi)/86400000 );


              eItemSpan.textContent =  item.Ad + " (" +
                        item.BaslangicTarihi.toLocaleDateString() + "-" + item.BitisTarihi.toLocaleDateString() + ")";
              eItem.appendChild(eItemSpan);


              paintTimeline(eItem,item.BaslangicTarihi,item.BitisTarihi );
              paintTimeline(eSubHeaderTimeLine,item.BaslangicTarihi,item.BitisTarihi);

              eItemList.appendChild(eItem);
          //}
      }
      
      eSubHeader.appendChild(eSubHeaderTimeLine);
      var eToplamGun = document.createElement("span");
      eToplamGun.textContent= subHeader.ToplamGun.toLocaleString();
      eToplamGun.style.float="right";
      eSubHeader.appendChild(eToplamGun);
    
    
    eSubHeader.appendChild(eItemList);
      
    if(eItemList.childElementCount>0){
        eSubHeaderList.appendChild(eSubHeader);
      }
      if (detay == "a")
        eSubHeader.click();
  }
    if (document.getElementById("demo").childElementCount>0)
        document.getElementById("demo").removeChild(document.getElementById("demo").children[0]);
    document.getElementById("demo").appendChild(eSubHeaderList); 
 }
    loadData();
    updateHeight(); 
  
    </script>
</html>