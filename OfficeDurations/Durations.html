<!DOCTYPE html>
<html lang="tr-TR"><!-- ?? tr-TR ?? -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date sorting</title>
    <link rel="stylesheet" href="css/style.css">
    
<!--
Türkiye Cumhuriyeti kurulmasından itibaren, devlet yönetiminde olan kişilerin, görevleri ve görevde bulundukları sürelerin zamana çizelgesinde gösterilmesi. 
    - Görev filtresi.
    - Sıralama seçenekleri. Alfabetik, yıla göre
    - Gösterim detay filtresi.
    - Kişi adı arama. Yazdıkça alternatiflerin gelmesi...(opsiyonel.)
Görsel Özellikler
    - üst tarafta sabit menü üzerinde filtre ve sıralama seçenekleri
    - üst tarafta sabit menünün hemen altında yine sabit olacak şekilde yıl kılavuzları. 10 yıllık aralıklar ile
    - her bir kişinin yanında toplam görev süresini gösteren zaman çizelgesi ve toplam gün sayısı
    - her bir kişinin altında yıllara göre görevleri ve zaman çizelgesi gösterimi
-->
</head>
<body>
<div class="container">
    <div id="header">
        <div style="float:left">
            <input id="c" type="checkbox" onclick="loadVeri()" checked>Cumhurbaşkanı
            <input id="b" type="checkbox" onclick="loadVeri()" checked>Başbakan
        </div>
        <span >
            <input name="sira" type="radio" onclick="sortToDate();loadVeri()" checked>İlk Görev Tarihine Göre
            <input name="sira" type="radio" onclick="sortToName();loadVeri()" >Alfabetik
        </span>
        
        <span style="float:right">
            <input name="detay" type="radio" onclick="loadVeri()" id="a">Sadece Başlık
            <input name="detay" type="radio" onclick="loadVeri()" checked>Hepsini Göster
        </span>
        
        <br><br>
        <div>
            <span style="width: 105em">
<!--                <span style="width: 200px;height: 1px;display: inline-block;">_</span>-->
                <span class="gorevline hyear" style="left: 20em; width: 0.0666667em;">1920</span>
                <span class="gorevline hyear" style="left: 28em; width: 0.0666667em;">1930</span>
                <span class="gorevline hyear" style="left: 36em; width: 0.0666667em;">1940</span>
                <span class="gorevline hyear" style="left: 44em; width: 0.0666667em;">1950</span>
                <span class="gorevline hyear" style="left: 52em; width: 0.0666667em;">1960</span>
                <span class="gorevline hyear" style="left: 60em; width: 0.0666667em;">1970</span>
                <span class="gorevline hyear" style="left: 68em; width: 0.0666667em;">1980</span>
                <span class="gorevline hyear" style="left: 76em; width: 0.0666667em;">1990</span>
                <span class="gorevline hyear" style="left: 84em; width: 0.0666667em;">2000</span>
                <span class="gorevline hyear" style="left: 92em; width: 0.0666667em;">2010</span>
                <span class="gorevline hyear" style="left: 100em; width: 0.0666667em;">2020</span>
            </span>
        </div>
    </div>
   
      
    
<p id="demo"></p>    
</div>


</body>
 

<script>
    var veri ="";
    /*
    
    TODO Notes:
    ----
    - format header nicely
    - sticky header and year guides
    - kisi collapse triangle (+/-)  and cursor
    - viewport sizable timeline
    - format nicely
    - year guides, timelines etc consistency. please not just put there
    - add - milletvekilleri, bakanlar,belediye başkanları
    
    ++++
    + gorev dates in a more readable form
    + kisi collapsable. 
    + kisi (one timeline to show next to it would be blast)
    + timeline next to gorev definition
    + better calculation for timeline width 
    + number of days on the office to the right side of the kisi. 
    + filter for different gorevs
    + collapse all
    + right calculation for the repeated days. !!
    + fill out all kisiler...
    
    */
    var kisiler = [];
    var t = "";
    loadDoc();
    
function paintTimelineNew(elem,bas,bit,txt){
    var beginning = new Date("1920-01-01");
    var eGorevLine =document.createElement("span");
    eGorevLine.classList.add("gorevline");
   
    eGorevLine.style.left=(dateDiffToWidth(beginning,bas) + 20.7).toString() + "em";
    eGorevLine.style.width=dateDiffToWidth(bas,bit).toString() + "em";
    eGorevLine.textContent=txt;
    elem.appendChild(eGorevLine);
}
function dateDiffToWidth(bas,bit){
    var px =(((bit.getFullYear()-bas.getFullYear()) * 12) - bas.getMonth()+ bit.getMonth()) ;
    return  px/15 ;
}
function myclick(e){
    //TODO: more elegant way !!
    this.children[1].hidden= !(this.children[1].hidden);
    this.children[3].hidden= !(this.children[3].hidden);
    //this.lastElementChild.hidden=!(this.lastElementChild.hidden);
}
    
function sortToDate(){
    if (veri=="") return;
     for (i=0;i< veri.kisiler.length;i++){
         var kisi =veri.kisiler[i];
         kisi.ilktarih = new Date("2100-01-01")
         for(var k = 0; k<kisi.Gorevler.length;k++){
            var gorev = kisi.Gorevler[k];
             var bas = new Date(gorev.Baslangic)
            if (bas<kisi.ilktarih){ kisi.ilktarih=bas;}
         }
    }
    veri.kisiler.sort(function(a,b){return a.ilktarih-b.ilktarih;});  
    
}
function sortToName(){
    if (veri=="") return;
    veri.kisiler.sort(function(a,b){
        var x = a.Ad.toLocaleLowerCase();
        var y = b.Ad.toLocaleLowerCase();
        if (x<y) {return -1;}
        if (x>y){return 1;}
        return 0;
        }); 
}

    
function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    myFunction(this);
    }
  };
  xhttp.open("GET", "data/data.json", true);
  xhttp.send();
}

function myFunction(xml) {
    veri =JSON.parse( xml.responseText);
    sortToDate();
    loadVeri();
}

function loadVeri(){
  if (veri=="") return;
  var i;
  var txt = "";
  var eKisiArticle = document.createElement("ul"); 
  var c = document.getElementById("c").checked;
  var b = document.getElementById("b").checked;
  var a = document.getElementById("a").checked;
 
   
  for (i=0;i< veri.kisiler.length;i++){
      var kisi =veri.kisiler[i];
      //var kisiArticle = document.createElement("ul");
      var eKisiHeader = document.createElement("li");
      eKisiHeader.classList.add("kisi");
      eKisiHeader.addEventListener("click",myclick);
      
      var eKisiAdi = document.createElement("span");
      //"&#x25BC;"  aşağı üçgen  //&#x25B6; sağa bakan  //&#x25C0; sola bakan
      eKisiAdi.textContent=  kisi.Ad + "("+kisi.Dogum + "-" + kisi.Olum + ") "; // For testing purposes + kisi.ilktarih.toLocaleDateString(); 
      eKisiAdi.classList.add("kisiadi");
      eKisiHeader.appendChild(eKisiAdi);
      
      var eKisiAdiTimeLine = document.createElement("span");
      eKisiAdiTimeLine.hidden=true;
      
      var eKisiGorevler = document.createElement("ul");
      eKisiGorevler.className="gorevlist";
      
      var toplamGun = 0;
      for(var k = 0; k<kisi.Gorevler.length;k++){
          var gorev = kisi.Gorevler[k];
          if((gorev.Tanimi=="Cumhurbaşkanı" && c) || (gorev.Tanimi=="Başbakan" &&b)){
              var eKisiGorev=document.createElement("li");
              var eGorevSpan = document.createElement("span");
              eGorevSpan.classList.add("gorev");

              var bas = new Date(gorev.Baslangic);
              var bit = new Date(gorev.Bitis);
              toplamGun+= Math.round((bit-bas)/86400000 );


              eGorevSpan.textContent =  gorev.Tanimi + " (" +
                        bas.toLocaleDateString() + "-" + bit.toLocaleDateString() + ")";
              eKisiGorev.appendChild(eGorevSpan);


              paintTimelineNew(eKisiGorev,bas,bit );
              paintTimelineNew(eKisiAdiTimeLine,bas,bit);

              eKisiGorevler.appendChild(eKisiGorev);
          }
      }
      
      eKisiHeader.appendChild(eKisiAdiTimeLine);
      var eToplamGun = document.createElement("span");
      eToplamGun.textContent=toplamGun.toLocaleString();
      eToplamGun.style.float="right";
      eKisiHeader.appendChild(eToplamGun);
    
    
    eKisiHeader.appendChild(eKisiGorevler);
      
    if(eKisiGorevler.childElementCount>0){
        eKisiArticle.appendChild(eKisiHeader);
      }
      if (a)
        eKisiHeader.click();
  }
    if (document.getElementById("demo").childElementCount>0)
        document.getElementById("demo").removeChild(document.getElementById("demo").children[0]);
    document.getElementById("demo").appendChild(eKisiArticle); 
}
    
   
    </script>
</html>