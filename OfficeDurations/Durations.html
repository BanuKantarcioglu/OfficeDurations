<!DOCTYPE html>
<html lang="tr-TR"><!-- ?? tr-TR ?? -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date sorting</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container">
<p id="demo"></p>    
</div>


</body>
 

<script>
    /*
    
    TODO Notes:
    
    - number of days on the office to the right side of the kisi. right calculation for the repeated days. !!
    - kisi (one timeline to show next to it would be blast)
    - kisi collapse triangle (+/-)  and cursor
    - viewport sizable timeline
    - format nicely
    - fill out all kisiler...
    - filter for different gorevs
    - add - milletvekilleri, bakanlar,belediye başkanları
    + gorev dates in a more readable form
    + kisi collapsable. 
    + timeline next to gorev definition
    + better calculation for timeline width 
    
    */
    var kisiler = [];
    var t = "";
    loadDoc();
    
function paintTimeline(elem,bas,bit){
    var cnv = document.createElement("canvas");
    var ctx = cnv.getContext("2d");
    cnv.style.width ="1200px";
    cnv.style.height="1em";
    
    var beginning = new Date("1923-1-1");
   
    var baslangicTarihi =new Date(bas);
    var bitisTarihi = new Date(bit);
    ctx.fillRect(dateDiffToPx(beginning,baslangicTarihi),0,
                 dateDiffToPx(baslangicTarihi,bitisTarihi),ctx.canvas.height);
    elem.appendChild(cnv);
    }
function paintTimelineNew(elem,bas,bit){
    var beginning = new Date("1923-01-01");
    var baslangicTarihi =new Date(bas);
    var bitisTarihi = new Date(bit);
   // elem.style.position="absolute";
   // elem.style.height="3em";
  
    elem.style.left= dateDiffToPx(beginning,baslangicTarihi).toString() + "em";
    elem.style.width=dateDiffToPx(baslangicTarihi,bitisTarihi).toString() + "em";
    
    
}
function dateDiffToPx(bas,bit){
    var px =(((bit.getFullYear()-bas.getFullYear()) * 12) - bas.getMonth()+ bit.getMonth()) ;
    return px/15;
}
    
function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    myFunction(this);
    }
  };
  xhttp.open("GET", "data/data.json", true);
  xhttp.send();
}
function myclick(e){
    this.lastChild.hidden=!(this.lastChild.hidden);
}

function myFunction(xml) {
  var i;
  var veri =JSON.parse( xml.responseText);
  var txt = "";
  var eKisiArticle = document.createElement("ul"); 
   
    //kisiArticle.style.width="100%";
  for (i=0;i< veri.kisiler.length;i++){
      var kisi =veri.kisiler[i];
      //var kisiArticle = document.createElement("ul");
      var eKisiHeader = document.createElement("li");
      eKisiHeader.className="kisi";
      var eKisiAdi = document.createElement("span");
      eKisiHeader.addEventListener("click",myclick)
      var eKisiGorevler = document.createElement("ul");
      eKisiGorevler.className="gorevlist";
      //"&#x25BC;"  aşağı üçgen  //&#x25B6; sağa bakan  //&#x25C0; sola bakan
      eKisiAdi.textContent=  kisi.Ad + "("+kisi.Dogum + "-" + kisi.Olum + ") "; 
      eKisiHeader.appendChild(eKisiAdi);
      var toplamGun = 0;
      for(var k = 0; k<kisi.Gorevler.length;k++){
          var gorev = kisi.Gorevler[k];
          var eKisiGorev=document.createElement("li");
          
          var eGorevSpan = document.createElement("span");
          var eGorevLine =document.createElement("span");
          eGorevSpan.className="gorev";
    
          
          var bas = new Date(gorev.Baslangic);
          var bit = new Date(gorev.Bitis);
          toplamGun+= Math.round((bit-bas)/86400000 );
          eGorevSpan.textContent =  gorev.Tanimi + "(" +
                    bas.toLocaleDateString() + "-" + bit.toLocaleDateString() + ")";
          eGorevLine.className="gorevline";
          paintTimelineNew(eGorevLine,gorev.Baslangic,gorev.Bitis );
          eKisiGorev.appendChild(eGorevSpan);
          eKisiGorev.appendChild(eGorevLine);
          eKisiGorevler.appendChild(eKisiGorev);
      }
      
      var eToplamGun = document.createElement("span");
      eToplamGun.textContent=toplamGun.toLocaleString();
      eToplamGun.style.float="right";
      eKisiHeader.appendChild(eToplamGun);
    
    
    eKisiHeader.appendChild(eKisiGorevler);
    eKisiArticle.appendChild(eKisiHeader);
    
  }
    document.getElementById("demo").appendChild (eKisiArticle); 
}
    
   
    </script>
</html>